<div class="container mt-5" *ngIf="!loading && bien; else loadingTpl">
  <h2 class="text-center mb-4 title">{{ libelleTypeEtActivite }} </h2>

  <div class="row">
    <!-- Colonne gauche (Photos) -->
<div class="col-md-6 text-center">

  <!-- Si plusieurs photos ‚Äî carrousel -->
  <div *ngIf="bien.photos && bien.photos.length > 1" id="carouselPhotos" class="carousel slide" data-bs-ride="carousel">
    <div class="carousel-inner">
      <div *ngFor="let photo of bien.photos; let i = index" class="carousel-item" [class.active]="i === 0">
        <img
          [src]="'https://127.0.0.1:8000' + photo"
          class="d-block w-100 rounded shadow-sm"
          alt="photo bien"
          onerror="this.src='https://127.0.0.1:8000/uploads/biens/sans_photo.png'"
        />
      </div>
    </div>
    <button class="carousel-control-prev" type="button" data-bs-target="#carouselPhotos" data-bs-slide="prev">
      <span class="carousel-control-prev-icon"></span>
    </button>
    <button class="carousel-control-next" type="button" data-bs-target="#carouselPhotos" data-bs-slide="next">
      <span class="carousel-control-next-icon"></span>
    </button>
  </div>

    <!-- Si une seule photo ou aucune -->
    <img
      *ngIf="!bien.photos || bien.photos.length <= 1"
      [src]="'https://127.0.0.1:8000' + (bien.photos?.[0] || '/uploads/biens/sans_photo.png')"
      class="img-fluid rounded shadow-sm"
      alt="photo bien"
      onerror="this.src='https://127.0.0.1:8000/uploads/biens/sans_photo.png'"
    />
  </div>

    <!-- Colonne droite (Infos) -->
    <div class="col-md-6">
      <h4 class="text-secondary mb-3">{{ bien.emplacement.ville }}, {{ bien.emplacement.pays }}</h4>
      <p><strong>Adresse :</strong> {{ bien.adresse }}</p>
      <p class="mb-1">
        <strong>Prix :</strong>
        {{ bien.prix | priceByActivity: bien.activite_key }}
      </p>

      <!--
      <p class="mb-2">
        <strong>Disponibilit√© :</strong>
        <span [class.text-success]="bien.disponible" [class.text-danger]="!bien.disponible">
          {{ bien.disponible ? 'Disponible' : 'Non disponible' }}
        </span>
      </p>      
      -->

      <p><strong>Surface :</strong> {{ bien.surface }} m¬≤</p>
      <p><strong>Chambres :</strong> {{ bien.nombre_de_chambres }} </p>
      <p><strong>Confort :</strong> {{ bien.conforts.join(', ') || 'Aucun' }}</p>
      <p><strong>Propri√©taire :</strong> {{ bien.proprietaire?.surnom }} </p>

      <div class="mt-4">
        <button class="btn btn-info me-2" (click)="onAction()">
          {{ libelleActivite }}
        </button>

        <a href="mailto:{{ bien.proprietaire?.email }}" class="btn btn-outline-info">Contacter le propri√©taire</a>
      </div>

      <p class="mt-3 text-muted small">
        Publi√© le {{ bien.created_at }} ‚Äî Modifi√© le {{ bien.updated_at }}
      </p>
    </div>
  </div>

  <!-- Description -->
  <div class="mt-4">
    <h5>Description</h5>
    <p [innerHTML]="bien.description"></p>
  </div>

  <!-- Boutons bas -->
  <div class="text-center mt-4">
    <button class="btn me-2" (click)="goBack()">‚¨Ö Retour √† la liste</button>

    <!-- Les boutons modifier et supprimer ne sont visibles que par l'auteur -->
    <button *ngIf="bien.proprietaire?.id === userId" class="btn me-2" (click)="editBien()">‚úèÔ∏è Modifier</button>
    <button *ngIf="bien.proprietaire?.id === userId" class="btn " (click)="deleteBien()">üóë Supprimer</button>
  </div>
</div>

  <app-modal-louer
    [visible]="showModal"
    [bienId]="bien?.id!"
    (closed)="closeModal()"
    (success)="onSuccess()">
  </app-modal-louer>

<ng-template #loadingTpl>
  <div class="text-center mt-5">
    <div class="spinner-border text-info" role="status"></div>
    <p class="mt-3">Chargement du logement... </p>
  </div>
</ng-template>
