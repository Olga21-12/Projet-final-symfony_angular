<div class="container mt-5">
  <h2 class="title text-center mb-2">Nos logements</h2>
  <small class="text-muted d-block text-center mb-3">
    {{ totalBiens }} annonces trouv√©es
  </small>

  <div class="row">
    <!-- Filtre -->
    <div class="col-lg-3 mb-4">
      <app-bien-filtre (search)="onSearch($event)"></app-bien-filtre>
    </div>

    <!-- List -->
    <div class="col-lg-9">
      <div *ngIf="loading" class="text-center mt-5">
        <div class="spinner-border text-info" role="status"></div>
        <p class="mt-3">Chargement des biens...</p>
      </div>

      <div *ngIf="error" class="alert alert-danger text-center">{{ error }}</div>

      <!-- Chancher -->
      <div class="view-toolbar" *ngIf="!loading && !error">
        <div class="view-toggle ms-auto">
          <button class="btn" [class.active]="viewMode==='grid'" (click)="toggleView('grid')" aria-label="Vue grille" title="Grille">
            ‚¨õ
          </button>
          <button class="btn" [class.active]="viewMode==='list'" (click)="toggleView('list')" aria-label="Vue liste" title="Liste">
            ‚ò∞
          </button>
        </div>
      </div>

      <!-- GRID VIEW -->
      <div class="row" *ngIf="!loading && !error && viewMode==='grid'">
        <div class="col-md-4 mb-4" *ngFor="let bien of biens">
          <div class="card h-100 position-relative overflow-visible">

            <!-- üëë Ic√¥ne de luxe -->
              <div *ngIf="bien.luxe" class="luxury-badge">
                <img
                  src="/assets/icons/crown.png"
                  alt="Luxe"
                  width="32"
                  height="32"
                  title="Bien de luxe"
                />
              </div>

            <h5 class="card-title">{{ bien.type }} ‚Äî {{ bien.activite }}</h5>

            <img
              [src]="'https://127.0.0.1:8000' + (bien.photos && bien.photos.length ? bien.photos[0] : '/uploads/biens/sans_photo.png')"
              class="card-img-top"
              alt="Photo du bien"
            />

            <div class="card-body">

              <p class="card-text" [innerHTML]="bien.description | truncate: 100 : true : '...' : true"></p>

              <p class="mb-1">
                <span class="badge-availability"
                      [ngClass]="bien.disponibilite ? 'available' : 'unavailable'">
                  {{ bien.disponibilite ? 'Disponible' : 'Non disponible' }}
                </span>
              </p>

              <div class="card-info mt-1">
                <p class="price mb-1">{{ bien.prix | currency:'EUR' }}</p>
                <p class="mb-1">
                  {{ bien.emplacement.ville }}, {{ bien.emplacement.pays }}<br>
                  {{ bien.surface }} m¬≤ ‚Ä¢ {{ bien.nombre_de_chambres }} chambres
                </p>
                <small class="text-secondary d-block">
                  üßç {{ bien.proprietaire }}<br>
                  ‚è± ajout√© il y a {{ bien.created_ago }} jour{{ bien.created_ago > 1 ? 's' : '' }}
                </small>
              </div>

              <button class="btn btn-info mt-auto" (click)="voirBien(bien.id)">
                Voir plus
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- LIST VIEW -->
      <div class="d-flex flex-column gap-3" *ngIf="!loading && !error && viewMode==='list'">
        <div class="bien-item position-relative" *ngFor="let bien of biens">

            <!-- üëë Ic√¥ne de luxe (LIST view) -->
              <div *ngIf="bien.luxe" class="luxury-badge-list">
                <img
                  src="/assets/icons/crown.png"
                  alt="Luxe"
                  width="28"
                  height="28"
                  title="Bien de luxe"
                />
              </div>

          <div class="bien-photo">
            <img [src]="'https://127.0.0.1:8000' + (bien.photos && bien.photos.length ? bien.photos[0] : '/uploads/biens/sans_photo.png')"
                 alt="Photo du bien" />
          </div>

          <div class="bien-info">
            <div class="d-flex align-items-center gap-2 flex-wrap">
              <div class="bien-title">{{ bien.type }} ‚Äî {{ bien.activite }}</div>
              <span class="badge-availability"
                    [ngClass]="bien.disponibilite ? 'available' : 'unavailable'">
                {{ bien.disponibilite ? 'Disponible' : 'Non disponible' }}
              </span>
            </div>

            <p class="bien-desc mt-1" [innerHTML]="bien.description | truncate: 150 : true : '...' : true"></p>

            <div class="text-secondary small">
              {{ bien.emplacement.ville }}, {{ bien.emplacement.pays }} ‚Ä¢
              {{ bien.surface }} m¬≤ ‚Ä¢
              {{ bien.nombre_de_chambres }} chambres ‚Ä¢
              üßç {{ bien.proprietaire }} ‚Ä¢
              ‚è± {{ bien.created_ago }} j
            </div>
          </div>

          <div class="bien-actions">
            <div class="price mb-2">{{ bien.prix | currency:'EUR' }}</div>
            <button class="btn btn-info" (click)="voirBien(bien.id)">Voir plus</button>
          </div>
        </div>
      </div>

      <!-- Pagination -->
      <app-paginator
        [currentPage]="currentPage"
        [totalPages]="totalPages"
        (pageChange)="changePage($event)">
      </app-paginator>
    </div>
  </div>
</div>
